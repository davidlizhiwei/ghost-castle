<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹½çµå¤å ¡æ¢é™©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #0a0a0a;
            color: #fff;
            overflow: hidden;
            height: 100vh;
        }

        #game-container {
            position: relative;
            width: 100%;
            height: 100vh;
            background: linear-gradient(to bottom, #1a0a2e 0%, #0a0a0a 100%);
        }

        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(ellipse at center, #2a1a4e 0%, #0a0a0a 100%);
            z-index: 100;
        }

        #start-screen h1 {
            font-size: 3em;
            color: #8b5cf6;
            text-shadow: 0 0 20px #8b5cf6, 0 0 40px #6d28d9;
            margin-bottom: 20px;
            animation: glow 2s ease-in-out infinite alternate;
        }

        @keyframes glow {
            from { text-shadow: 0 0 20px #8b5cf6, 0 0 40px #6d28d9; }
            to { text-shadow: 0 0 30px #a78bfa, 0 0 60px #7c3aed; }
        }

        #start-screen p {
            font-size: 1.2em;
            color: #c4b5fd;
            margin-bottom: 40px;
            text-align: center;
            max-width: 600px;
            line-height: 1.6;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.3em;
            background: linear-gradient(45deg, #6d28d9, #8b5cf6);
            border: none;
            border-radius: 30px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .btn:hover {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.8);
        }

        #game-screen {
            display: none;
            width: 100%;
            height: 100%;
            position: relative;
        }

        #room {
            position: relative;
            width: 100%;
            height: 100%;
            background-size: cover;
            background-position: center;
            transition: background 0.5s;
        }

        #flashlight {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at 50% 50%, transparent 10%, rgba(0,0,0,0.95) 50%, rgba(0,0,0,1) 100%);
            pointer-events: none;
            z-index: 10;
        }

        #ui {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 20;
            font-size: 1.2em;
        }

        .stat {
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            margin-bottom: 10px;
            border: 2px solid #4c1d95;
        }

        #inventory {
            position: absolute;
            bottom: 20px;
            left: 20px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 15px;
            border: 2px solid #4c1d95;
            min-width: 200px;
        }

        #inventory h3 {
            color: #a78bfa;
            margin-bottom: 10px;
        }

        #inventory-items {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .item {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, #6d28d9, #8b5cf6);
            border-radius: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.5em;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .item:hover {
            transform: scale(1.1);
        }

        #message {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px 40px;
            border-radius: 15px;
            border: 2px solid #8b5cf6;
            z-index: 30;
            font-size: 1.2em;
            text-align: center;
            max-width: 600px;
            display: none;
        }

        #choices {
            position: absolute;
            bottom: 20px;
            right: 20px;
            z-index: 20;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .choice-btn {
            padding: 12px 25px;
            font-size: 1em;
            background: linear-gradient(45deg, #4c1d95, #6d28d9);
            border: 2px solid #8b5cf6;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-btn:hover {
            background: linear-gradient(45deg, #6d28d9, #8b5cf6);
            transform: translateX(-5px);
        }

        .ghost {
            position: absolute;
            font-size: 4em;
            animation: float 3s ease-in-out infinite;
            cursor: pointer;
            z-index: 15;
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.8));
        }

        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .jump-scare {
            animation: jumpscare 0.5s ease-in-out;
        }

        @keyframes jumpscare {
            0% { transform: scale(0.1); opacity: 0; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(1); opacity: 1; }
        }

        #win-screen, #lose-screen {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.95);
            z-index: 200;
        }

        #win-screen h2 {
            font-size: 3em;
            color: #fbbf24;
            text-shadow: 0 0 30px #fbbf24;
            margin-bottom: 20px;
        }

        #lose-screen h2 {
            font-size: 3em;
            color: #ef4444;
            text-shadow: 0 0 30px #ef4444;
            margin-bottom: 20px;
        }

        .particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            width: 10px;
            height: 10px;
            background: rgba(139, 92, 246, 0.6);
            border-radius: 50%;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }

        #hint {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 20;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 20px;
            border-radius: 10px;
            border: 2px solid #6d28d9;
            color: #c4b5fd;
            cursor: pointer;
            transition: all 0.3s;
        }

        #hint:hover {
            background: rgba(109, 40, 217, 0.5);
        }
    </style>
</head>
<body>
    <div id="game-container">
        <!-- å¼€å§‹ç•Œé¢ -->
        <div id="start-screen">
            <h1>ğŸ° å¹½çµå¤å ¡æ¢é™© ğŸ‘»</h1>
            <p>ä½ è¢«å›°åœ¨ä¸€åº§ç¥ç§˜çš„å¤å ¡é‡Œ...<br>
            æ‰¾åˆ° 5 ä¸ªé­”æ³•æ°´æ™¶ï¼Œè§£å¼€è°œé¢˜ï¼Œé€ƒç¦»è¿™é‡Œï¼<br>
            ä½†è¦å°å¿ƒï¼Œå¤å ¡é‡Œä¸åªæœ‰ä½ ä¸€ä¸ªäºº...</p>
            <button class="btn" onclick="startGame()">å¼€å§‹æ¢é™©</button>
        </div>

        <!-- æ¸¸æˆç•Œé¢ -->
        <div id="game-screen">
            <div id="room">
                <div id="flashlight"></div>
                <div class="particles" id="particles"></div>
            </div>

            <div id="ui">
                <div class="stat">ğŸ’ æ°´æ™¶ï¼š<span id="crystal-count">0</span>/5</div>
                <div class="stat">â¤ï¸ ç”Ÿå‘½ï¼š<span id="health">3</span></div>
            </div>

            <div id="hint" onclick="showHint()">ğŸ’¡ æç¤º</div>

            <div id="inventory">
                <h3>ğŸ’ èƒŒåŒ…</h3>
                <div id="inventory-items"></div>
            </div>

            <div id="message"></div>

            <div id="choices"></div>
        </div>

        <!-- èƒœåˆ©ç•Œé¢ -->
        <div id="win-screen">
            <h2>ğŸ‰ æ­å–œä½ é€ƒå‡ºæ¥äº†ï¼ğŸ‰</h2>
            <p style="font-size: 1.5em; color: #c4b5fd; margin-bottom: 30px;">ä½ æ‰¾åˆ°äº†æ‰€æœ‰æ°´æ™¶ï¼ŒæˆåŠŸé€ƒç¦»äº†å¹½çµå¤å ¡ï¼</p>
            <button class="btn" onclick="location.reload()">å†ç©ä¸€æ¬¡</button>
        </div>

        <!-- å¤±è´¥ç•Œé¢ -->
        <div id="lose-screen">
            <h2>ğŸ˜± æ¸¸æˆç»“æŸ</h2>
            <p style="font-size: 1.5em; color: #c4b5fd; margin-bottom: 30px;">å¹½çµæŠ“ä½äº†ä½ ...ä½ è¢«å›°åœ¨å¤å ¡é‡Œäº†</p>
            <button class="btn" onclick="location.reload()">å†è¯•ä¸€æ¬¡</button>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentRoom: 'entrance',
            crystals: 0,
            health: 3,
            inventory: [],
            flags: {}
        };

        // æˆ¿é—´æ•°æ®
        const rooms = {
            entrance: {
                name: 'ğŸšª å…¥å£å¤§å…',
                bg: 'linear-gradient(to bottom, #2a1a4e 0%, #0a0a0a 100%)',
                description: 'ä½ ç«™åœ¨é˜´æ£®çš„å¤§å…é‡Œï¼Œå››å‘¨æŒ‚ç€å¤è€çš„ç”»åƒï¼Œä¼¼ä¹åœ¨ç›¯ç€ä½ çœ‹...',
                choices: [
                    { text: 'ğŸ“– å»å›¾ä¹¦é¦†', to: 'library' },
                    { text: 'ğŸ½ï¸ å»é¤å…', to: 'dining' },
                    { text: 'ğŸªœ ä¸Šæ¥¼æ¢¯', to: 'hallway', req: 'key' }
                ],
                items: [],
                ghost: false
            },
            library: {
                name: 'ğŸ“š å›¾ä¹¦é¦†',
                bg: 'linear-gradient(to bottom, #1a0a3e 0%, #0a0a0a 100%)',
                description: 'ä¹¦æ¶ä¸Šæ‘†æ»¡äº†å¤è€çš„ä¹¦ç±ï¼Œä¸€æœ¬å‘å…‰çš„ä¹¦å¸å¼•äº†ä½ çš„æ³¨æ„...',
                choices: [
                    { text: 'ğŸ“– æŸ¥çœ‹å‘å…‰çš„ä¹¦', action: 'book' },
                    { text: 'ğŸ”™ è¿”å›å¤§å…', to: 'entrance' },
                    { text: 'ğŸ”¦ æœç´¢ä¹¦æ¶', action: 'search_shelves' }
                ],
                items: ['crystal'],
                ghost: true,
                ghostChance: 0.3
            },
            dining: {
                name: 'ğŸ½ï¸ é¤å…',
                bg: 'linear-gradient(to bottom, #1a0a2e 0%, #0a0a0a 100%)',
                description: 'é•¿æ¡Œä¸Šæ‘†æ»¡äº†è…çƒ‚çš„é£Ÿç‰©ï¼Œä¸€åªä¹Œé¸¦ç«™åœ¨åŠç¯ä¸Šçœ‹ç€ä½ ...',
                choices: [
                    { text: 'ğŸ”‘ æ£€æŸ¥æ©±æŸœ', action: 'cabinet' },
                    { text: 'ğŸ”™ è¿”å›å¤§å…', to: 'entrance' },
                    { text: 'ğŸ– æŸ¥çœ‹é¤æ¡Œ', action: 'table' }
                ],
                items: ['key'],
                ghost: true,
                ghostChance: 0.4
            },
            hallway: {
                name: 'ğŸªœ äºŒæ¥¼èµ°å»Š',
                bg: 'linear-gradient(to bottom, #2a0a4e 0%, #0a0a0a 100%)',
                description: 'èµ°å»Šå¾ˆé•¿ï¼Œä¸¤è¾¹æœ‰å¾ˆå¤šé—¨ã€‚ä¸€é˜µå†·é£å¹è¿‡...',
                choices: [
                    { text: 'ğŸ›ï¸ è¿›å…¥å§å®¤', to: 'bedroom' },
                    { text: 'ğŸ”¬ è¿›å…¥å®éªŒå®¤', to: 'lab' },
                    { text: 'ğŸ”™ ä¸‹æ¥¼', to: 'entrance' }
                ],
                items: [],
                ghost: true,
                ghostChance: 0.5
            },
            bedroom: {
                name: 'ğŸ›ï¸ å¤è€å§å®¤',
                bg: 'linear-gradient(to bottom, #1a0a3e 0%, #0a0a0a 100%)',
                description: 'ä¸€å¼ å¤è€çš„å››æŸ±åºŠï¼Œé•œå­ä¸­ä¼¼ä¹æœ‰ä»€ä¹ˆåœ¨åŠ¨...',
                choices: [
                    { text: 'ğŸ’ æ£€æŸ¥æ°´æ™¶', action: 'crystal2' },
                    { text: 'ğŸª æŸ¥çœ‹é•œå­', action: 'mirror' },
                    { text: 'ğŸ”™ è¿”å›èµ°å»Š', to: 'hallway' }
                ],
                items: ['crystal'],
                ghost: true,
                ghostChance: 0.3
            },
            lab: {
                name: 'ğŸ”¬ ç¥ç§˜å®éªŒå®¤',
                bg: 'linear-gradient(to bottom, #0a1a3e 0%, #0a0a0a 100%)',
                description: 'æ¡Œå­ä¸Šæ‘†æ»¡äº†å¥‡æ€ªçš„è¯æ°´å’Œä»ªå™¨ï¼Œä¸€ä¸ªéª·é«…å‘ä½ èµ°æ¥...',
                choices: [
                    { text: 'ğŸ’€ å’Œéª·é«…å¯¹è¯', action: 'skeleton' },
                    { text: 'ğŸ§ª æ£€æŸ¥è¯æ°´', action: 'potions' },
                    { text: 'ğŸ”™ è¿”å›èµ°å»Š', to: 'hallway' }
                ],
                items: ['crystal'],
                ghost: true,
                ghostChance: 0.6
            },
            secret: {
                name: 'ğŸ—ï¸ ç§˜å¯†æˆ¿é—´',
                bg: 'linear-gradient(to bottom, #3a0a5e 0%, #0a0a0a 100%)',
                description: 'ä½ å‘ç°äº†éšè—çš„ç§˜å¯†æˆ¿é—´ï¼æœ€åçš„æ°´æ™¶å°±åœ¨è¿™é‡Œï¼',
                choices: [
                    { text: 'ğŸ’ å–å¾—æ°´æ™¶', action: 'final_crystal' }
                ],
                items: ['crystal'],
                ghost: false
            },
            crypt: {
                name: 'ğŸ’€ åœ°ä¸‹å¢“ç©´',
                bg: 'linear-gradient(to bottom, #0a0a0a 0%, #1a0a1e 100%)',
                description: 'é˜´æ£®çš„å¢“ç©´ï¼Œå››å‘¨éƒ½æ˜¯å¢“ç¢‘ã€‚ä¸€ä¸ªå¹½çµåœ¨é£˜è¡...',
                choices: [
                    { text: 'âš°ï¸ æ£€æŸ¥çŸ³æ£º', action: 'coffin' },
                    { text: 'ğŸ”™ é€ƒè·‘', to: 'entrance' }
                ],
                items: ['crystal'],
                ghost: true,
                ghostChance: 0.7
            }
        };

        // éŸ³æ•ˆæ¨¡æ‹Ÿï¼ˆè§†è§‰åé¦ˆï¼‰
        function playSound(type) {
            const flash = document.createElement('div');
            flash.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: ${type === 'scare' ? 'rgba(255,0,0,0.3)' : 'rgba(139,92,246,0.3)'};
                z-index: 1000;
                pointer-events: none;
            `;
            document.body.appendChild(flash);
            setTimeout(() => flash.remove(), 200);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(text, duration = 2000) {
            const msg = document.getElementById('message');
            msg.textContent = text;
            msg.style.display = 'block';
            setTimeout(() => msg.style.display = 'none', duration);
        }

        // æ›´æ–° UI
        function updateUI() {
            document.getElementById('crystal-count').textContent = gameState.crystals;
            document.getElementById('health').textContent = gameState.health;

            const inv = document.getElementById('inventory-items');
            inv.innerHTML = '';
            gameState.inventory.forEach(item => {
                const div = document.createElement('div');
                div.className = 'item';
                div.textContent = item === 'key' ? 'ğŸ”‘' : item === 'crystal' ? 'ğŸ’' : 'ğŸ“œ';
                div.title = item === 'key' ? 'å¤å ¡é’¥åŒ™' : item === 'crystal' ? 'é­”æ³•æ°´æ™¶' : 'å¤è€å·è½´';
                inv.appendChild(div);
            });
        }

        // å¹½çµå‡ºç°
        function showGhost() {
            const room = document.getElementById('room');
            const ghost = document.createElement('div');
            ghost.className = 'ghost jump-scare';
            ghost.textContent = ['ğŸ‘»', 'ğŸ’€', 'ğŸ‘½', 'ğŸƒ'][Math.floor(Math.random() * 4)];
            ghost.style.left = Math.random() * 60 + 20 + '%';
            ghost.style.top = Math.random() * 40 + 30 + '%';
            room.appendChild(ghost);

            playSound('scare');
            gameState.health--;
            updateUI();

            setTimeout(() => {
                ghost.remove();
                if (gameState.health <= 0) {
                    gameOver();
                }
            }, 1000);
        }

        // æ¸²æŸ“æˆ¿é—´
        function renderRoom() {
            const room = rooms[gameState.currentRoom];
            const roomDiv = document.getElementById('room');
            roomDiv.style.background = room.bg;

            // æ¸²æŸ“é€‰æ‹©
            const choicesDiv = document.getElementById('choices');
            choicesDiv.innerHTML = '';

            room.choices.forEach(choice => {
                if (choice.req && !gameState.inventory.includes(choice.req)) {
                    return; // éœ€è¦é’¥åŒ™ä½†è¿˜æ²¡æœ‰
                }

                const btn = document.createElement('button');
                btn.className = 'choice-btn';
                btn.textContent = choice.text;
                btn.onclick = () => handleChoice(choice);
                choicesDiv.appendChild(btn);
            });

            // å¹½çµåˆ¤å®š
            if (room.ghost && Math.random() < (room.ghostChance || 0.3)) {
                setTimeout(showGhost, 500);
            }

            showMessage(room.description);
        }

        // å¤„ç†é€‰æ‹©
        function handleChoice(choice) {
            if (choice.to) {
                gameState.currentRoom = choice.to;
                renderRoom();
                return;
            }

            if (choice.action) {
                handleAction(choice.action);
            }
        }

        // å¤„ç†åŠ¨ä½œ
        function handleAction(action) {
            switch(action) {
                case 'book':
                    if (!gameState.flags.bookRead) {
                        showMessage('ğŸ“– ä¹¦ä¸Šå†™ç€ï¼š"å¯»æ‰¾éšè—åœ¨é»‘æš—ä¸­çš„å…‰èŠ’"... ä½ è·å¾—äº†ä¸€ä¸ªæ°´æ™¶ï¼', 3000);
                        gameState.crystals++;
                        gameState.flags.bookRead = true;
                        updateUI();
                        checkWin();
                    } else {
                        showMessage('ä½ å·²ç»è¯»è¿‡è¿™æœ¬ä¹¦äº†', 1500);
                    }
                    break;

                case 'search_shelves':
                    if (!gameState.flags.shelvesSearched) {
                        showMessage('ğŸ”¦ ä½ åœ¨ä¹¦æ¶åé¢å‘ç°äº†ä¸€å¼ å¤è€çš„åœ°å›¾ï¼', 2000);
                        gameState.inventory.push('map');
                        gameState.flags.shelvesSearched = true;
                        updateUI();
                    } else {
                        showMessage('ä¹¦æ¶å·²ç»è¢«æœç´¢è¿‡äº†', 1500);
                    }
                    break;

                case 'cabinet':
                    if (!gameState.flags.cabinetOpened) {
                        showMessage('ğŸ”‘ ä½ åœ¨æ©±æŸœé‡Œæ‰¾åˆ°äº†ä¸€æŠŠå¤è€çš„é’¥åŒ™ï¼', 2000);
                        gameState.inventory.push('key');
                        gameState.flags.cabinetOpened = true;
                        updateUI();
                    } else {
                        showMessage('æ©±æŸœå·²ç»ç©ºäº†', 1500);
                    }
                    break;

                case 'table':
                    showMessage('ğŸ– é£Ÿç‰©å·²ç»è…çƒ‚äº†ï¼Œä½†ä½ åœ¨æ¡Œä¸‹å‘ç°äº†ä¸€äº›é‡‘å¸', 2000);
                    break;

                case 'crystal2':
                    if (!gameState.flags.crystal2Taken) {
                        showMessage('ğŸ’ ä½ ä»åºŠå¤´æŸœé‡Œæ‰¾åˆ°äº†ä¸€ä¸ªå‘å…‰çš„æ°´æ™¶ï¼', 2000);
                        gameState.crystals++;
                        gameState.flags.crystal2Taken = true;
                        updateUI();
                        checkWin();
                    } else {
                        showMessage('æ°´æ™¶å·²ç»è¢«æ‹¿èµ°äº†', 1500);
                    }
                    break;

                case 'mirror':
                    if (!gameState.flags.mirrorUsed) {
                        showMessage('ğŸª é•œå­ä¸­æ˜¾ç¤ºå‡ºä¸€ä¸ªéšè—çš„æˆ¿é—´å…¥å£...åœ¨å›¾ä¹¦é¦†ï¼', 2500);
                        gameState.flags.mirrorUsed = true;
                        rooms.library.choices.push({ text: 'ğŸ—ï¸ è¿›å…¥ç§˜å¯†æˆ¿é—´', to: 'secret', req: 'map' });
                    } else {
                        showMessage('é•œå­å·²ç»æ­ç¤ºäº†ç§˜å¯†', 1500);
                    }
                    break;

                case 'skeleton':
                    showMessage('ğŸ’€ éª·é«…è¯´ï¼š"æƒ³è¦æ°´æ™¶ï¼Œå…ˆå›ç­”æˆ‘çš„é—®é¢˜ï¼šä»€ä¹ˆè¶Šæ´—è¶Šè„ï¼Ÿ"... ç­”æ¡ˆæ˜¯"æ°´"ï¼ä½ è·å¾—äº†æ°´æ™¶ï¼', 3000);
                    gameState.crystals++;
                    gameState.flags.skeletonTalked = true;
                    updateUI();
                    checkWin();
                    break;

                case 'potions':
                    if (!gameState.flags.potionsChecked) {
                        showMessage('ğŸ§ª ä½ å–ä¸‹äº†ä¸€ç“¶çº¢è‰²è¯æ°´...æ„Ÿè§‰å……æ»¡äº†åŠ›é‡ï¼ç”Ÿå‘½ +1', 2000);
                        gameState.health++;
                        gameState.flags.potionsChecked = true;
                        updateUI();
                    } else {
                        showMessage('è¯æ°´å·²ç»å–å®Œäº†', 1500);
                    }
                    break;

                case 'final_crystal':
                    showMessage('ğŸ’ ä½ æ‰¾åˆ°äº†æœ€åçš„æ°´æ™¶ï¼å¤å ¡å¼€å§‹éœ‡åŠ¨...', 2000);
                    gameState.crystals++;
                    updateUI();
                    setTimeout(() => {
                        document.getElementById('game-screen').style.display = 'none';
                        document.getElementById('win-screen').style.display = 'flex';
                        createParticles();
                    }, 2000);
                    break;

                case 'coffin':
                    if (!gameState.flags.coffinOpened) {
                        showMessage('âš°ï¸ çŸ³æ£ºé‡Œæœ‰ä¸€ä¸ªå‘å…‰çš„æ°´æ™¶ï¼ä½ æ‹¿åˆ°äº†ï¼', 2000);
                        gameState.crystals++;
                        gameState.flags.coffinOpened = true;
                        updateUI();
                        checkWin();
                    } else {
                        showMessage('çŸ³æ£ºå·²ç»ç©ºäº†', 1500);
                    }
                    break;
            }
        }

        // æ£€æŸ¥èƒœåˆ©
        function checkWin() {
            if (gameState.crystals >= 5) {
                // éœ€è¦æ‰¾åˆ°ç§˜å¯†æˆ¿é—´æ‰èƒ½èµ¢
                if (gameState.currentRoom === 'secret') {
                    return; // å·²ç»åœ¨èƒœåˆ©æµç¨‹ä¸­
                }
                showMessage('ğŸ’ ä½ æ”¶é›†äº†æ‰€æœ‰æ°´æ™¶ï¼æ‰¾åˆ°å‡ºå£é€ƒç¦»è¿™é‡Œï¼', 3000);
                // æ·»åŠ å‡ºå£é€‰é¡¹
                const choicesDiv = document.getElementById('choices');
                const exitBtn = document.createElement('button');
                exitBtn.className = 'choice-btn';
                exitBtn.textContent = 'ğŸšª é€ƒç¦»å¤å ¡';
                exitBtn.onclick = () => {
                    document.getElementById('game-screen').style.display = 'none';
                    document.getElementById('win-screen').style.display = 'flex';
                    createParticles();
                };
                choicesDiv.appendChild(exitBtn);
            }
        }

        // æ¸¸æˆç»“æŸ
        function gameOver() {
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('lose-screen').style.display = 'flex';
        }

        // æ˜¾ç¤ºæç¤º
        function showHint() {
            const hints = [
                'ğŸ’¡ å¤šå’Œåœºæ™¯ä¸­çš„ç‰©å“äº’åŠ¨ï¼Œå¯èƒ½ä¼šæœ‰å‘ç°',
                'ğŸ’¡ æœ‰äº›é—¨éœ€è¦é’¥åŒ™æ‰èƒ½æ‰“å¼€',
                'ğŸ’¡ é•œå­å¯èƒ½ä¼šæ­ç¤ºéšè—çš„ç§˜å¯†',
                'ğŸ’¡ éª·é«…çŸ¥é“ä¸€äº›é‡è¦çš„äº‹æƒ…...',
                'ğŸ’¡ æ”¶é›†æ‰€æœ‰ 5 ä¸ªæ°´æ™¶æ‰èƒ½é€ƒè„±'
            ];
            showMessage(hints[Math.floor(Math.random() * hints.length)], 3000);
        }

        // åˆ›å»ºç²’å­æ•ˆæœ
        function createParticles() {
            const container = document.querySelector('#win-screen .particles');
            if (!container) {
                const particles = document.createElement('div');
                particles.className = 'particles';
                document.querySelector('#win-screen').appendChild(particles);
            }

            for (let i = 0; i < 50; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 2 + 's';
                particle.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.querySelector('#win-screen .particles').appendChild(particle);
            }
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-screen').style.display = 'block';
            renderRoom();
            updateUI();
        }

        // åˆå§‹åŒ–ç²’å­æ•ˆæœï¼ˆå¼€å§‹ç•Œé¢ï¼‰
        function initStartParticles() {
            const startScreen = document.getElementById('start-screen');
            const particles = document.createElement('div');
            particles.className = 'particles';
            startScreen.appendChild(particles);

            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 3 + 's';
                particle.style.animationDuration = (Math.random() * 3 + 3) + 's';
                particles.appendChild(particle);
            }
        }

        initStartParticles();
    </script>
</body>
</html>
